<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>@xanderdin</title><link href="http://xanderdin.github.io/" rel="alternate"></link><link href="http://xanderdin.github.io/feeds/all.atom.xml" rel="self"></link><id>http://xanderdin.github.io/</id><updated>2015-10-25T14:04:00+03:00</updated><entry><title>Healing the freezing of Jiayu G2F phone</title><link href="http://xanderdin.github.io/healing-the-freezing-of-Jiayu-G2F-phone.html" rel="alternate"></link><updated>2015-10-25T14:04:00+03:00</updated><author><name>Alex P.</name></author><id>tag:xanderdin.github.io,2015-10-25:healing-the-freezing-of-Jiayu-G2F-phone.html</id><summary type="html">&lt;p&gt;I ordered a &lt;strong&gt;Jiayu G2F WCDMA&lt;/strong&gt; phone with 1Gb RAM and 4Gb ROM at Aliexpress.
The phone is pretty cool but it has a very disappointing problem - it freezes
very often without any visible reason. Searching on the web revealed that this
problem pertains to the whole model and not exclusively to my device. I
purchased the phone for my daughter and she liked it very much, so we didn't
want sending it back to seller. Moreover, I hoped this was a software related
problem, so it could be fixed or overcome. And I wasn't mistaken.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;WARNING! Everything described here was performed exclusively with the
Jiayu G2F WCDMA model with 1Gb RAM, 4Gb ROM, Android 4.2.2, kernel 3.4.5,
build G2FW-20141027-W-R-V0.3.6. An attempt to flash with the provided boot
image any other model will most probably damage it.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;I analysed the problem and found that the system was launching a new instance
of &lt;strong&gt;memsicd3416x&lt;/strong&gt; service almost every two seconds. The old instances of the
service proceded to run in memory and there were a lot of them after some time.
I guessed that such behaviour finally leads to system resource shortage and the
freeze.&lt;/p&gt;
&lt;p&gt;The start parameters of &lt;strong&gt;memsicd3416x&lt;/strong&gt; service are described in &lt;strong&gt;init.rc&lt;/strong&gt;
file:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
service memsicd3416x /system/bin/memsicd3416x
    disabled
    user system
    group system
    class main
&lt;/pre&gt;
&lt;p&gt;Reading of Android &lt;strong&gt;init.rc&lt;/strong&gt; documentation gave me a thought that maybe the
&lt;strong&gt;oneshot&lt;/strong&gt; option was missing among the parameters. That option is aimed to
prevent multiple service runs.&lt;/p&gt;
&lt;p&gt;I decided to add that option, but as far as such addition requires a reflashing
of the phone's boot partition, and reflashing could &amp;quot;brick&amp;quot; your device in case
of an error, I decided to make sure my guesses are true. Fortunately, during my
next search I found a modified image of the boot partition, which as they said,
was aimed to eliminate some troubles with that phone model's magnetic compass.
When I unpacked that image and compared it with the original boot image I
immediately found a proof for my guesses:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
diff -Naur original/rootfs/init.rc modified/rootfs/init.rc
--- original/rootfs/init.rc 2015-10-22 22:41:58.406635561 +0300
+++ modified/rootfs/init.rc 2015-10-22 22:41:48.970914550 +0300
&amp;#64;&amp;#64; -1317,7 +1317,8 &amp;#64;&amp;#64;
 #

 service msensord /system/bin/msensord
-    class main
+    oneshot
+ #   class main

 service s62xd /system/bin/s62xd
     disabled
&amp;#64;&amp;#64; -1339,9 +1340,10 &amp;#64;&amp;#64;

 service memsicd3416x /system/bin/memsicd3416x
      disabled
+     oneshot
      user system
     group system
-    class main
+ #   class main

 service akmd8975 /system/bin/akmd8975
     disabled
&lt;/pre&gt;
&lt;p&gt;The &lt;strong&gt;oneshot&lt;/strong&gt; option was really nessesary! I decided to flash phone's boot
partition with that found modified boot image.&lt;/p&gt;
&lt;div class="section" id="flashing"&gt;
&lt;h2&gt;Flashing&lt;/h2&gt;
&lt;p&gt;I used the &lt;strong&gt;fastboot&lt;/strong&gt; utility for flashing. I initially tried to flash using
my computer with Debian 8 Jessie OS.  But some problems with &lt;em&gt;cdc_acm&lt;/em&gt; driver
prevented &lt;strong&gt;fastboot&lt;/strong&gt; utility from seeing connected devices, although &lt;strong&gt;adb&lt;/strong&gt;
utility was working fine. I didn't want to solve another problem
simultaniuosly, so I decided to download any Live-CD Linux distribution and
flash from it.&lt;/p&gt;
&lt;p&gt;I chose &lt;a class="reference external" href="https://www.archlinux.org"&gt;Arch Linux&lt;/a&gt; for that purpose. Downloaded
&lt;a class="reference external" href="http://mirror.rackspace.com/archlinux/iso/2015.10.01/archlinux-2015.10.01-dual.iso"&gt;ISO image&lt;/a&gt;,
burned it to CD, and booted it on an old 32-bit notebook. When it booted to
console I proceeded with installing needed packages:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
pacman -Sy
pacman -S android-tools
pacman -S android-udev
&lt;/pre&gt;
&lt;p&gt;I downloaded from my primary desktop computer the prepared modified boot image
of the phone's boot partition:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
scp mylogin&amp;#64;mydesktop:boot.img ./
&lt;/pre&gt;
&lt;p&gt;Connected phone to the notebook's USB, switched on the phone's &lt;strong&gt;USB debug mode&lt;/strong&gt;
and issued a command in console:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
adb devices
&lt;/pre&gt;
&lt;p&gt;Seeing the phone in the list of devices I issued a command to reboot it to
&lt;strong&gt;bootloader mode&lt;/strong&gt;:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
adb reboot bootloader
&lt;/pre&gt;
&lt;p&gt;When the phone rebooted, it displayed a message notifying that it had booted
to &lt;strong&gt;bootloader mode&lt;/strong&gt;. The next command was:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
fastboot devices
&lt;/pre&gt;
&lt;p&gt;Seeing once again the phone in the list of devices I issued a command to flash
it:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
fastboot flash boot boot.img
&lt;/pre&gt;
&lt;p&gt;It was about two seconds and the flashing process completed successfuly.
Rebooting the phone:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
fastboot reboot
&lt;/pre&gt;
&lt;p&gt;The phone rebooted and the problem with the freezing had gone. Several days
already passed since I flashed it. The &lt;strong&gt;memsicd3416x&lt;/strong&gt; service is not spawning
and the phone is not freezing.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="links"&gt;
&lt;h2&gt;Links&lt;/h2&gt;
&lt;p&gt;The modified boot image was found
&lt;a class="reference external" href="http://www.mediafire.com/download/avcudzc753254tb/JY-G2F-W-kernel-changer-to-0.3.6b.zip"&gt;here&lt;/a&gt;.
Some information about it at
&lt;a class="reference external" href="http://4pda.ru/forum/index.php?showtopic=584280&amp;amp;view=findpost&amp;amp;p=40437370"&gt;4pda.ru&lt;/a&gt; site.&lt;/p&gt;
&lt;p&gt;Description of init.rc is
&lt;a class="reference external" href="https://github.com/android/platform_system_core/blob/jb-release/init/readme.txt"&gt;over here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;For the sake of convinience I uploaded the modified and the original boot
images to my git repository &lt;a class="reference external" href="https://github.com/xanderdin/Jiayu-G2F-freeze-fix"&gt;https://github.com/xanderdin/Jiayu-G2F-freeze-fix&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Take care!&lt;/em&gt;&lt;/p&gt;
&lt;/div&gt;
</summary></entry><entry><title>Лечение телефона Jiayu G2F от зависаний</title><link href="http://xanderdin.github.io/healing-the-freezing-of-Jiayu-G2F-phone-ru.html" rel="alternate"></link><updated>2015-10-25T14:04:00+03:00</updated><author><name>Alex P.</name></author><id>tag:xanderdin.github.io,2015-10-25:healing-the-freezing-of-Jiayu-G2F-phone-ru.html</id><summary type="html">&lt;p&gt;Заказал на Aliexpress телефон &lt;strong&gt;Jiayu G2F WCDMA&lt;/strong&gt;, модель с 1Гб RAM и 4Гб ROM.
Телефончик оказался неплохой, но к сожалению обнаружилась в нем одна досадная
проблема - он очень часто зависал намертво без каких-либо видимых на то причин.
Поиск в интернете показал, что эта проблема не только моего экземпляра, а
присуща вообще этой модели в целом. Телефон я покупал для моей дочки и ей он
очень понравился, поэтому отправлять его обратно продавцу не хотелось.
К тому же меня не покидала надежда, что проблема где-то на программном уровне,
а следовательно ее можно как-то исправить или обойти. И в этом я не ошибался.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ВНИМАНИЕ! Все описанное тут было проделано исключительно с
моделью Jiayu G2F WCDMA, 1Гб RAM, 4Гб ROM, Android 4.2.2, ядро 3.4.5,
сборка G2FW-20141027-W-R-V0.3.6. Попытка прошить предложенным boot-образом
другую модель скорее всего выведет ее из строя.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Анализ проблемы выявил, что примерно с интервалом в две секунды в системе
запускался новый экземпляр сервиса &lt;strong&gt;memsicd3416x&lt;/strong&gt;. При этом старые экземпляры
сервиса продолжали находится в памяти и со временем их становилось огромное
количество. Стало понятно, что такое бесконтрольное размножение в конце концов
приводит к исчерпанию системных ресурсов и вероятно служит причиной зависания.&lt;/p&gt;
&lt;p&gt;Параметры запуска сервиса &lt;strong&gt;memsicd3416x&lt;/strong&gt; определены в файле &lt;strong&gt;init.rc&lt;/strong&gt;:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
service memsicd3416x /system/bin/memsicd3416x
    disabled
    user system
    group system
    class main
&lt;/pre&gt;
&lt;p&gt;Чтение документации по &lt;strong&gt;init.rc&lt;/strong&gt; Андроида привело к мысли, что среди
параметров этого сервиса не хватает опции &lt;strong&gt;oneshot&lt;/strong&gt;, которая должна
препятствовать множественному запуску сервиса.&lt;/p&gt;
&lt;p&gt;Решил добавить эту опцию, но так как процедура требует перепрошивки
boot-раздела телефона, что в случае ошибки приведет к &amp;quot;кирпичу&amp;quot;, решил
сначала убедится в правоте своих рассуждений. К счастью, в процессе
дальнейшего поиска мне попался модифицированный образ boot-раздела,
который, как утверждалось, нацелен на устранение каких-то проблем с
компасом этой модели телефона. Когда я его распаковал и сравнил с
содержимым оригинального boot-раздела, то сразу же убедился в правоте
своих рассуждений:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
diff -Naur original/rootfs/init.rc modified/rootfs/init.rc
--- original/rootfs/init.rc 2015-10-22 22:41:58.406635561 +0300
+++ modified/rootfs/init.rc 2015-10-22 22:41:48.970914550 +0300
&amp;#64;&amp;#64; -1317,7 +1317,8 &amp;#64;&amp;#64;
 #

 service msensord /system/bin/msensord
-    class main
+    oneshot
+ #   class main

 service s62xd /system/bin/s62xd
     disabled
&amp;#64;&amp;#64; -1339,9 +1340,10 &amp;#64;&amp;#64;

 service memsicd3416x /system/bin/memsicd3416x
      disabled
+     oneshot
      user system
     group system
-    class main
+ #   class main

 service akmd8975 /system/bin/akmd8975
     disabled
&lt;/pre&gt;
&lt;p&gt;И в самом деле опция &lt;strong&gt;oneshot&lt;/strong&gt; была нужна! Решил прошить boot-раздел
телефона используя этот найденный модифицированный boot-образ.&lt;/p&gt;
&lt;div class="section" id="id1"&gt;
&lt;h2&gt;Прошивка&lt;/h2&gt;
&lt;p&gt;Для прошивки я использовал утилиту &lt;strong&gt;fastboot&lt;/strong&gt;. Изначально я попытался
осуществить прошивку с моего компьютера с системой Debian 8 Jessie. Но из-за
каких-то проблем с драйвером &lt;em&gt;cdc_acm&lt;/em&gt;, &lt;strong&gt;fastboot&lt;/strong&gt; не видел подключенного
телефона, хотя &lt;strong&gt;adb&lt;/strong&gt; работал без проблем. Решать одновременно и эту проблему
не хотелось, поэтому я решил скачать какой-нибудь Live-CD Linux дистрибутив
и прошить из него.&lt;/p&gt;
&lt;p&gt;Для этой цели выбрал &lt;a class="reference external" href="https://www.archlinux.org"&gt;Arch Linux&lt;/a&gt;. Скачал
&lt;a class="reference external" href="http://mirror.rackspace.com/archlinux/iso/2015.10.01/archlinux-2015.10.01-dual.iso"&gt;ISO образ&lt;/a&gt;,
записал на CD диск и загрузился на стареньком 32-х битном ноутбуке. Попав в
консоль, установил требуемые пакеты:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
pacman -Sy
pacman -S android-tools
pacman -S android-udev
&lt;/pre&gt;
&lt;p&gt;Загрузил со своего основного компьютера подготовленный модифицированный
boot-образ загрузочного раздела телефона:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
scp mylogin&amp;#64;mydesktop:boot.img ./
&lt;/pre&gt;
&lt;p&gt;Подключил телефон к USB ноутбука, перевел телефон в &lt;strong&gt;режим отладки по USB&lt;/strong&gt;
и в консоли выполнил команду:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
adb devices
&lt;/pre&gt;
&lt;p&gt;Увидев телефон в списке устройств, дал команду для перезагрузки телефона
в режим &lt;strong&gt;bootloader&lt;/strong&gt;:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
adb reboot bootloader
&lt;/pre&gt;
&lt;p&gt;Телефон перезагрузился и на его дисплее появилось уведомление о том, что
он загружен в режиме &lt;strong&gt;bootloder&lt;/strong&gt;. Теперь дал следующую команду:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
fastboot devices
&lt;/pre&gt;
&lt;p&gt;Убедившись, что телефон отображается и в этом списке, дал команду на
прошивку:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
fastboot flash boot boot.img
&lt;/pre&gt;
&lt;p&gt;Не прошло и двух секунд, как прошивка выполнилась успешно. Перезагружаю
телефон:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
fastboot reboot
&lt;/pre&gt;
&lt;p&gt;Телефон перезагрузился и все готово, проблема с зависанием решена! Со
времени прошивки и на момент написания этих строк прошло уже несколько
дней. Сервис &lt;strong&gt;memsicd3416x&lt;/strong&gt; не размножается и телефон не виснет.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="id2"&gt;
&lt;h2&gt;Ссылки&lt;/h2&gt;
&lt;p&gt;Модифицированный boot-образ был найден
&lt;a class="reference external" href="http://www.mediafire.com/download/avcudzc753254tb/JY-G2F-W-kernel-changer-to-0.3.6b.zip"&gt;здесь&lt;/a&gt;.
Информация о нем на форуме сайта
&lt;a class="reference external" href="http://4pda.ru/forum/index.php?showtopic=584280&amp;amp;view=findpost&amp;amp;p=40437370"&gt;4pda.ru&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Описание init.rc можно посмотреть
&lt;a class="reference external" href="https://github.com/android/platform_system_core/blob/jb-release/init/readme.txt"&gt;вот здесь&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Для удобства выложил оригинальный и модифицированный boot-образы в
git-репозиторий &lt;a class="reference external" href="https://github.com/xanderdin/Jiayu-G2F-freeze-fix"&gt;https://github.com/xanderdin/Jiayu-G2F-freeze-fix&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Всем удачи!&lt;/em&gt;&lt;/p&gt;
&lt;/div&gt;
</summary></entry></feed>